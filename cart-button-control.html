<!--
  Cart Button Control
  Disables Add to Cart and Buy it Now buttons until photos are uploaded.
  Works with select-photos.html and select-photos-landscape.html via custom events.
-->
<style>
  /* Visual styling for disabled cart buttons */
  button[data-photos-required="true"] {
    opacity: 0.5 !important;
    cursor: not-allowed !important;
  }
</style>
<script>
  (function () {
    const TOOLTIP_MESSAGE = "Please select and upload your photos first";

    const initCartButtonControl = () => {
      // Find Add to Cart button (Shopify uses dynamic IDs)
      const addToCartBtn = document.querySelector(
        'button[name="add"].product-form__submit, .product-form__submit[type="submit"]',
      );

      // Find Buy it Now button
      const buyItNowBtn = document.querySelector(
        ".shopify-payment-button button, .shopify-payment-button__button",
      );

      // Store original button states and titles
      const originalAddToCartDisabled = addToCartBtn?.disabled || false;
      const originalAddToCartTitle = addToCartBtn?.title || "";
      const originalBuyItNowDisabled = buyItNowBtn?.disabled || false;
      const originalBuyItNowTitle = buyItNowBtn?.title || "";

      // Check if this product requires photo upload
      const hasPhotoUploader = document.querySelector(".file-upload-container");

      if (!hasPhotoUploader) {
        // No photo uploader on this product, leave buttons as-is
        return;
      }

      // Disable buttons initially with tooltip
      if (addToCartBtn) {
        addToCartBtn.disabled = true;
        addToCartBtn.setAttribute("data-photos-required", "true");
        addToCartBtn.title = TOOLTIP_MESSAGE;
      }

      if (buyItNowBtn) {
        buyItNowBtn.disabled = true;
        buyItNowBtn.setAttribute("data-photos-required", "true");
        buyItNowBtn.title = TOOLTIP_MESSAGE;
      }

      // Listen for photos uploaded event
      document.addEventListener("photosUploaded", function (e) {
        if (addToCartBtn) {
          addToCartBtn.disabled = originalAddToCartDisabled;
          addToCartBtn.removeAttribute("data-photos-required");
          addToCartBtn.title = originalAddToCartTitle;
        }

        if (buyItNowBtn) {
          buyItNowBtn.disabled = originalBuyItNowDisabled;
          buyItNowBtn.removeAttribute("data-photos-required");
          buyItNowBtn.title = originalBuyItNowTitle;
        }
      });
    };

    // Initialize when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initCartButtonControl);
    } else {
      initCartButtonControl();
    }
  })();
</script>
